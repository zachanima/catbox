"use strict";

var Sprite = Component.extend({
  period: 6,
  delay: 1,
  start: 0,
  end: 0,
  runonce: false,
  current: 0,



  Update: function() {
    delay -= Time.deltaTime;
    if (delay < 0) {
      ++current;
      delay += period/(end-start + 1);
    }

    if (current > end) {
      current -= end - start + 1;
    }
  },


  
  Render: function() {
    if (this.images && this.images[this.current]) {
      context.drawImage(this.images[this.current], -this.images[this.current].width / 2, -this.images[this.current].height / 2);
    }
  },



  Load: function(src, columns, rows) {
    this.image = new Image();
    this.image.src = src;
    this.images = [];

    columns = columns || 1;
    rows = rows || 1;

    var _this = this;
    this.image.onload = function() {
      _this.Chop(columns, rows);
    }
    
  },



  Chop: function(columns, rows) {
    var canvas = document.createElement("canvas");
    var context = canvas.getContext('2d');
    canvas.width = this.image.width / columns;
    canvas.height = this.image.height / rows;

    for (var row = 0; row < rows; ++row) {
      for (var column = 0; column < columns; ++column) {
        context.drawImage(this.image, column*canvas.width, row*canvas.height);
        var image = new Image();
        image.src = canvas.toDataURL();
        this.images.push(image);
      }
    }
  },



  Animate: function(start, end, runonce) {
    this.start = start; 
    this.end = end;
    this.runonce = runonce;
  } 
});
